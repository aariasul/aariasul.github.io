<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Invitaci√≥n de boda ‚Äî Paola & Giancarlo</title>
  <meta name="description" content="Acomp√°√±anos a celebrar nuestra boda. Paola & Giancarlo ‚Äî 25 de octubre de 2025." />

  <!-- Open Graph -->
  <meta property="og:title" content="Invitaci√≥n de boda ‚Äî Paola & Giancarlo" />
  <meta property="og:description" content="Acomp√°√±anos a celebrar nuestra boda. 25 de octubre de 2025." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="img/couple-hero.jpg" />
  <meta property="og:locale" content="es_CR" />

  <link rel="icon" href="img/couple-logo.svg" type="image/svg+xml">

  <!-- Fuentes -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Pinyon+Script&family=Quicksand:wght@300;400;600&display=swap" rel="stylesheet" />

  <!-- Loader de configuraci√≥n (solo expone window.config) -->
  <script src="config-loader.js" defer></script>

  <style>
    :root{
      --bg: rgb(243,242,238);
      --card: rgb(251,250,248);
      --ink: #2a2a2a;
      --muted: #696969;
      --accent: rgba(0,0,0,0.08);
      --shadow: 0 8px 24px rgba(0,0,0,.08);
      --radius: 15px;
      --radius-lg: 25px;
      --ease: cubic-bezier(.16,1,.3,1);
      --brand-ink: #1f2937;
      --title: "Pinyon Script", cursive;
      --base: "Quicksand", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      --names-start-offset: 60%;
    }

    html, body { height: 100%; scroll-behavior: smooth; overflow-x: hidden; }
    body{
      margin:0; background: var(--bg); color: var(--ink); font-family: var(--base);
      line-height: 1.6; -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
    }

    .wrap{ width: 80%; max-width: 960px; margin: 0 auto; padding: 24px 0 64px; }

    h1, h2, h3, .script { font-family: var(--title); font-weight: 400; letter-spacing: .2px; color: var(--brand-ink); margin: 0 0 8px; }
    h1 { font-size: clamp(36px, 6vw, 60px); line-height: 1.1; }
    h2 { font-size: clamp(30px, 5vw, 42px); line-height: 1.15; }
    h3 { font-size: clamp(22px, 3.8vw, 28px); line-height: 1.2; }

    p { margin: 0 0 12px; }
    .muted { color: var(--muted); }

    .card{
      background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow);
      padding: clamp(16px, 3.2vw, 28px); margin: 28px auto;
    }

    .center { text-align: center; }
    .btn{
      display: inline-block; background: var(--bg); color: var(--ink); border-radius: var(--radius-lg);
      padding: 12px 18px; text-decoration: none; box-shadow: var(--shadow); border: 1px solid var(--accent);
      transition: transform .18s var(--ease), box-shadow .18s var(--ease); cursor: pointer; font-weight: 600;
    }
    .btn:focus-visible{ outline: 3px solid #94a3b8; outline-offset: 2px; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 12px 28px rgba(0,0,0,.1); }
    .btn:active { transform: translateY(0); box-shadow: var(--shadow); }

    /* ===== Control de audio ‚Äî DESKTOP ===== */
    .audio-ctrl{
      position: fixed; top: 14px; right: 14px; z-index: 100;
      background: var(--card); border: 1px solid var(--accent); border-radius: 999px;
      padding: 8px 12px; box-shadow: var(--shadow); display: flex; align-items: center; gap: 10px; user-select: none;
    }
    .audio-ctrl .label{ font-size: 14px; }
    #playButton{
      background: white; color: black; padding: 8px 12px; border: none; cursor: pointer; border-radius: 10px; opacity: .95; font: inherit;
    }
    .switch { position: relative; display: inline-block; width: 46px; height: 26px; opacity: .95; }
    .switch input { display: none; }
    .slider { position: absolute; cursor: pointer; inset: 0; background-color: #c99c; transition: .25s; border-radius: 8px; }
    .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background: white; transition: .25s; border-radius: 6px; }
    input:checked + .slider { background-color: #e76e55; }
    input:checked + .slider:before { transform: translateX(20px); }

    /* ===== Control de audio ‚Äî M√ìVIL ===== */
    .audio-btn{
      display: none;
      position: fixed; top: 5px; right: 5px; z-index: 100;
      width: 48px; height: 48px; border: 1px solid rgba(0,0,0,0.08); border-radius: 12px;
      background: #ffffff; color: #111; box-shadow: 0 8px 24px rgba(0,0,0,.08);
      cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent;
      transition: transform .18s var(--ease), box-shadow .18s var(--ease), background .18s, color .18s;
    }
    .audio-btn::before{ content: "‚ñ∂"; display: grid; place-items: center; font-size: 18px; line-height: 1; }
    .audio-btn[aria-pressed="true"]{ background: #e76e55; color: #fff; }
    .audio-btn[aria-pressed="true"]::before{ content: "‚è∏"; }
    .audio-btn:hover{ transform: translateY(-1px); box-shadow: 0 12px 28px rgba(0,0,0,.1); }
    .audio-btn:active{ transform: translateY(0); box-shadow: 0 8px 24px rgba(0,0,0,.08); }

    /* Logo */
    .logo{ width: 100px; height: 100px; object-fit: contain; display:block; margin: 24px auto 10px; border-radius: 12px; }

    /* Hero */
    .hero{
      position: relative; margin: 12px auto 8px; width: min(90%, 1200px);
      border-radius: 18px; overflow: clip; box-shadow: var(--shadow);
    }
    .hero img{
      display:block; width:100%; height:auto;
      opacity: 0; transform: scale(1.01);
      transition: opacity 2s ease, transform 2s ease;
    }
    .hero.loaded img{ opacity: 1; transform: scale(1); }

    .hero .names{
      position: absolute; inset: 0; display: grid; place-items: center;
      opacity: 0; transform: translateY(var(--names-start-offset, 60%));
      padding: 12px; text-align: center; will-change: transform, opacity;
    }
    .hero.loaded .names{
      animation:
        fadeInNames 2s ease 2s forwards,
        riseNames   3s cubic-bezier(.16,1,.3,1) 2s forwards;
    }
    .hero .names .script{
      color: rgb(251,250,248);
      text-shadow:
        0 3px 10px rgba(0,0,0,1),
        1px 0 1px rgba(0,0,0,1),
        -1px 0 1px rgba(0,0,0,1),
        0 1px 1px rgba(0,0,0,1),
        0 -1px 1px rgba(0,0,0,1),
        0 0 18px  rgba(0,0,0,.85);
      font-size: clamp(34px, 6vw, 72px);
      line-height: 1.1;
    }
    @keyframes fadeInNames{ from{opacity:0} to{opacity:1} }
    @keyframes riseNames{ from{transform:translateY(var(--names-start-offset,60%))} to{transform:translateY(0)} }

    .date { text-align:center; font-size: 18px; margin-top: 8px; }

    /* Countdown */
    .countdown{ display: grid; grid-template-columns: repeat(4, minmax(60px, 1fr)); gap: 12px; margin-top: 16px; }
    .cd-box{ text-align:center; background: #fff; border-radius: 12px; padding: 12px; border: 1px solid var(--accent); box-shadow: var(--shadow); }
    .cd-num{ font-size: clamp(22px, 5vw, 34px); font-weight: 700; }
    .cd-label{ font-size: 12px; letter-spacing: .8px; text-transform: uppercase; color: var(--muted); }

    .observe{ opacity: 0; transform: translateY(12px); transition: opacity .9s var(--ease), transform .9s var(--ease); }
    .observe.in-view{ opacity: 1; transform: none; }

    .fly-left, .fly-right{
      overflow: hidden; margin: 34px auto; width:min(90%,1200px);
      border-radius: 18px; box-shadow: var(--shadow);
    }
    .fullw{ width: 100%; }
    .fullw img{ width:100%; height:auto; display:block; }
    .fly-left .fullw, .fly-right .fullw{
      opacity: 0; transition: opacity 1.8s var(--ease), transform 1.8s var(--ease); will-change: transform, opacity;
    }
    .fly-left .fullw{  transform: translateX(-110%); }
    .fly-right .fullw{ transform: translateX(110%); }
    .fly-left.in-view .fullw, .fly-right.in-view .fullw{ opacity: 1; transform: translateX(0); }

    .photo-frame{ border-radius: 18px; overflow: hidden; box-shadow: var(--shadow); }

    .form{ display:grid; gap: 12px; margin-top: 8px; grid-template-columns: 1fr; }
    .field{ display:grid; gap: 6px; }
    label{ font-weight: 600; }
    input[type="text"], input[type="number"]{ font: inherit; padding: 12px; border-radius: 10px; border: 1px solid var(--accent); background: #fff; }
    .help{ font-size: 12px; color: var(--muted); }

    .decor{ display: block; margin: 0 auto; width: 200px; height: auto; }

    .error{ color: #b91c1c; font-size: 12px; min-height: 1.2em; }
    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }

    @media (prefers-reduced-motion: reduce){
      .observe, .hero img, .hero .names, .fly-left .fullw, .fly-right .fullw {
        transition: none !important; transform: none !important; opacity: 1 !important; animation: none !important;
      }
      .audio-ctrl, .audio-btn{ transition: none !important; }
    }
    @media (max-width: 560px){
      .countdown{ grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 8px; }
      .cd-box{ padding: 8px; }
      .cd-num{ font-size: clamp(18px, 6vw, 22px); }
      .cd-label{ font-size: 10px; letter-spacing: .6px; }
      .audio-ctrl{ display: none; } .audio-btn{ display: block; width: 44px; height: 44px; border-radius: 10px; }
    }
  </style>
</head>
<body>

  <!-- Audio Desktop -->
  <div class="audio-ctrl" id="audioCtrl">
    <span class="label" aria-hidden="true">üéµ</span>
    <button type="button" id="playButton" aria-pressed="false">Activar melod√≠a</button>
    <label class="switch" aria-label="Interruptor de m√∫sica">
      <input type="checkbox" id="playToggle" />
      <span class="slider round" aria-hidden="true"></span>
    </label>
  </div>

  <!-- Audio M√≥vil -->
  <button class="audio-btn" id="audioBtn" aria-pressed="false" aria-label="Reproducir melod√≠a"></button>

  <!-- Audio -->
  <audio id="bgAudio" preload="metadata" loop>
    <source src="audio/song.mp3" type="audio/mpeg" />
    <source src="audio/song.m4a" type="audio/mp4" />
    <source src="audio/song.ogg" type="audio/ogg" />
  </audio>

  <main class="wrap" id="top">
    <!-- Logo -->
    <img class="logo" src="img/couple-logo.svg" width="100" height="100" alt="Logotipo de la pareja" />

    <!-- Hero -->
    <section class="hero" id="hero">
      <img src="img/couple-hero.jpg" alt="Fotograf√≠a principal de la pareja" loading="eager" decoding="async" />
      <div class="names">
        <div class="script">Paola &amp; Giancarlo</div>
      </div>
    </section>
    <div class="date muted" id="date-readable">25 de octubre de 2025 ‚Ä¢ 10:00 a. m.</div>

    <!-- Intro + Countdown -->
    <section class="card observe">
      <div class="center">
        <p id="intro-text">Nos llena de alegr√≠a invitarte a compartir con nosotros este d√≠a tan especial.</p>
        <div class="countdown" id="countdown" aria-live="polite">
          <div class="cd-box"><div class="cd-num" id="cd-days">0</div><div class="cd-label">D√≠as</div></div>
          <div class="cd-box"><div class="cd-num" id="cd-hours">0</div><div class="cd-label">Horas</div></div>
          <div class="cd-box"><div class="cd-num" id="cd-mins">0</div><div class="cd-label">Minutos</div></div>
          <div class="cd-box"><div class="cd-num" id="cd-secs">0</div><div class="cd-label">Segundos</div></div>
        </div>
        <div style="margin-top:16px;">
          <img src="img/decor-100.svg" alt="Elemento decorativo" loading="lazy" decoding="async" class="decor" />
        </div>
      </div>
    </section>

    <!-- Imagen fly-in izquierda -->
    <section class="fly-left">
      <div class="fullw">
        <img src="img/couple-left.jpg" alt="Fotograf√≠a de la pareja (izquierda)" loading="lazy" decoding="async" />
      </div>
    </section>

    <!-- Ceremonia -->
    <section class="card observe" id="ceremonia">
      <div class="center">
        <img src="img/decor-150.svg" alt="Decoraci√≥n ceremonia" loading="lazy" decoding="async" class="decor observe" />
        <h2 style="margin-top:8px;">Ceremonia Religiosa</h2>
        <p><strong id="church-label">Iglesia cat√≥lica de Paquera</strong></p>
        <p><strong>Hora:</strong> 10:00 a. m.</p>
        <div class="actions" style="margin-top:12px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
          <a href="#" class="btn" data-nav="waze" id="church-waze" data-query="R398+W5Q, Provincia de Puntarenas, Paquera">Waze</a>
          <a href="#" class="btn" data-nav="gmap" id="church-gmap" data-query="R398+W5Q, Provincia de Puntarenas, Paquera">Google Maps</a>
        </div>
      </div>
    </section>

    <!-- Recepci√≥n -->
    <section class="card observe" id="recepcion">
      <div class="center">
        <img src="img/decor-200.svg" alt="Decoraci√≥n recepci√≥n" loading="lazy" decoding="async" class="decor observe" />
        <h2 style="margin-top:8px;">Recepci√≥n</h2>
        <p><strong id="reception-label">Bella Vista House ‚Äî Paquera</strong></p>
        <p><strong>Hora:</strong> Posterior a la ceremonia</p>
        <div class="actions" style="margin-top:12px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
          <a href="#" class="btn" data-nav="waze" id="reception-waze" data-query="V3X7+MF, Provincia de Puntarenas, Gigante">Waze</a>
          <a href="#" class="btn" data-nav="gmap" id="reception-gmap" data-query="V3X7+MF, Provincia de Puntarenas, Gigante">Google Maps</a>
        </div>
      </div>
    </section>

    <!-- Imagen fly-in derecha -->
    <section class="fly-right">
      <div class="fullw">
        <img src="img/couple-right.jpg" alt="Fotograf√≠a de la pareja (derecha)" loading="lazy" decoding="async" />
      </div>
    </section>

    <!-- Programa -->
    <section class="card observe">
      <h2 class="center">Programa de la boda</h2>
      <div class="fullw" style="margin-top:10px;">
        <img src="img/programa.svg" alt="Programa de la boda" loading="lazy" decoding="async" />
      </div>
    </section>

    <!-- Vestimenta -->
    <section class="card observe">
      <div class="center">
        <img src="img/decor-160.svg" alt="Decoraci√≥n vestimenta" loading="lazy" decoding="async" class="decor" />
        <h2 style="margin-top:8px;">Vestimenta</h2>
        <h3>Vestimenta formal</h3>
        <p class="muted" style="max-width:60ch; margin: 6px auto 0;">
          Celebramos nuestro amor en tonos de beige y verde olivo. Les sugerimos vestir en esta paleta para ser parte de la armon√≠a de este d√≠a especial.
        </p>
      </div>
    </section>

    <!-- Imagen + texto adultos -->
    <section class="observe" style="margin: 34px auto; width:min(90%,1200px);">
      <div class="fullw observe photo-frame">
        <img src="img/couple-hero2.jpg" alt="Fotograf√≠a de la pareja" loading="lazy" decoding="async" />
      </div>
      <div class="card observe center" style="margin-top:16px;">
        <p>Para que todos disfrutemos plenamente, nuestra boda ser√° un evento solo para adultos. Estaremos encantados de celebrar con ustedes.</p>
      </div>
    </section>

    <!-- ======= RSVP DIN√ÅMICO (Opci√≥n 2: endpoint + token) ======= -->
    <section class="card observe" id="rsvp">
      <div class="center">
        <img src="img/decor-100.svg" alt="Decoraci√≥n confirmar asistencia" loading="lazy" decoding="async" class="decor" />
        <h2 style="margin-top:8px;">Confirmar Asistencia</h2>
        <p class="muted" id="rsvp-deadline">Por favor confirma antes del <strong>10 de octubre de 2025</strong>.</p>
        <p class="help center" id="rsvp-note">Cargando‚Ä¶</p>
      </div>

      <!-- Formulario din√°mico (solo se muestra con endpoint + token) -->
      <form id="rsvp-form" class="form" style="display:none">
        <div class="field">
          <label for="rsvpSelect"><strong>Acompa√±antes</strong> (puedes reducir tu cupo):</label>
          <select id="rsvpSelect" name="acompanantes"></select>
          <span class="help" id="rsvp-total">Total de personas: 1</span>
        </div>
        <div class="center" style="margin-top:6px;">
          <button class="btn" type="submit">Confirmar asistencia</button>
          <a id="wa-btn" class="btn" target="_blank" rel="noopener" style="display:none">Avisar por WhatsApp</a>
        </div>
        <p class="help center" id="rsvp-msg" style="margin-top:8px;"></p>
      </form>

      <!-- Fallback Google Form (si en config pones type: "google_form") -->
      <div id="rsvp-fallback" style="display:none; margin-top:12px;">
        <iframe id="rsvp-iframe" style="width:100%; min-height:900px; border:0; background:#fff"></iframe>
      </div>
    </section>

    <!-- Despedida -->
    <section class="card observe center">
      <p>Gracias por acompa√±arnos en este momento tan importante para nosotros, con cari√±o:</p>
      <h2>Paola &amp; Giancarlo</h2>
    </section>
  </main>

  <script>
    /* ===== Utilidades ===== */
    function $(s){ return document.querySelector(s); }
    function $all(s){ return document.querySelectorAll(s); }
    function int(v,d){ v=Number(v); return isFinite(v)?v:d; }
    function qs(k){ return new URLSearchParams(location.search).get(k); }
    function digits(s){ return String(s||'').replace(/\D+/g,''); }

    /* ===== Audio ===== */
    (function(){
      const myAudio   = $('#bgAudio');
      const playToggle= $('#playToggle');
      const playButton= $('#playButton');
      const audioBtn  = $('#audioBtn');
      function setPlayingState(on){
        if(on){
          myAudio.volume = 1.0;
          myAudio.play().then(()=>{
            if (playToggle) playToggle.checked = true;
            if (playButton){ playButton.textContent = "Pausar melod√≠a"; playButton.setAttribute("aria-pressed","true"); }
            if (audioBtn){ audioBtn.setAttribute("aria-pressed","true"); audioBtn.setAttribute("aria-label","Pausar melod√≠a"); }
          }).catch(e=>{
            console.error(e);
            if (playToggle) playToggle.checked = false;
            if (playButton){ playButton.setAttribute("aria-pressed","false"); playButton.textContent = "Activar melod√≠a"; }
            if (audioBtn){ audioBtn.setAttribute("aria-pressed","false"); audioBtn.setAttribute("aria-label","Reproducir melod√≠a"); }
          });
        } else {
          myAudio.pause();
          if (playToggle) playToggle.checked = false;
          if (playButton){ playButton.setAttribute("aria-pressed","false"); playButton.textContent = "Activar melod√≠a"; }
          if (audioBtn){ audioBtn.setAttribute("aria-pressed","false"); audioBtn.setAttribute("aria-label","Reproducir melod√≠a"); }
        }
      }
      if (playToggle) playToggle.addEventListener("change", () => setPlayingState(playToggle.checked));
      if (playButton) playButton.addEventListener("click", () => setPlayingState(myAudio.paused));
      if (audioBtn)   audioBtn.addEventListener("click",   () => setPlayingState(myAudio.paused));
      myAudio.addEventListener("error", ()=>{ setPlayingState(false); });
    })();

    /* ===== Hero y on-scroll ===== */
    (function(){
      const hero = $('#hero');
      const img = hero.querySelector('img');
      if (img.complete) hero.classList.add('loaded');
      else img.addEventListener('load', () => hero.classList.add('loaded'));

      const io = new IntersectionObserver((entries)=>{
        for(const e of entries){
          if(e.isIntersecting){ e.target.classList.add('in-view'); io.unobserve(e.target); }
        }
      }, { threshold: 0.18 });
      $all('.observe, .fly-left, .fly-right').forEach(el => io.observe(el));
    })();

    /* ===== Countdown ===== */
    (function(){
      function start(iso){
        const end = new Date(iso).getTime();
        const elDays  = $('#cd-days');
        const elHours = $('#cd-hours');
        const elMins  = $('#cd-mins');
        const elSecs  = $('#cd-secs');
        function update(){
          const now = Date.now();
          let diff = Math.max(0, end - now);
          const s = Math.floor(diff / 1000);
          const days = Math.floor(s / 86400);
          const hours = Math.floor((s % 86400) / 3600);
          const mins = Math.floor((s % 3600) / 60);
          const secs = s % 60;
          elDays.textContent  = String(days);
          elHours.textContent = String(hours).padStart(2,'0');
          elMins.textContent  = String(mins).padStart(2,'0');
          elSecs.textContent  = String(secs).padStart(2,'0');
        }
        update(); setInterval(update, 1000);
      }
      // arrancar√° en init() cuando leamos config.json
      window._startCountdown = start;
    })();

    /* ===== Deep links Waze/Maps ===== */
    function deepLink(appUrl, webUrl){
      let fallback = setTimeout(()=>{ window.location.href = webUrl; }, 900);
      window.addEventListener('blur', ()=>{ clearTimeout(fallback); }, { once:true });
      window.location.href = appUrl;
    }
    function handleNavClick(e){
      e.preventDefault();
      const el = e.currentTarget;
      const app = el.getAttribute('data-nav');    // "waze" | "gmap"
      const q   = el.getAttribute('data-query') || '';
      const enc = encodeURIComponent(q);
      if(app === 'waze'){
        deepLink(`waze://?q=${enc}&navigate=yes`, `https://waze.com/ul?q=${enc}&navigate=yes`);
      }else{
        deepLink(`google.navigation:q=${enc}`, `https://www.google.com/maps/dir/?api=1&destination=${enc}&travelmode=driving`);
      }
    }
    $all('[data-nav]').forEach(a => a.addEventListener('click', handleNavClick));

    /* ===== Init desde config.json ===== */
    (function(){
      function whenConfig(cb){
        let tries=80, iv=setInterval(function(){
          if (window.config || tries--<=0){ clearInterval(iv); cb(window.config||{}); }
        }, 50);
      }
      whenConfig(function(cfg){
        try{
          // Nombres y fecha legible (si existen en config)
          if (cfg.names && cfg.names.primary) document.querySelector('.hero .names .script').textContent = cfg.names.primary;
          if (cfg.date && cfg.date.readable) $('#date-readable').textContent = cfg.date.readable;

          // Countdown con la fecha ISO de config
          if (cfg.date && cfg.date.iso) window._startCountdown(cfg.date.iso);

          // Mapas desde config.links (si existen)
          if (cfg.links && cfg.links.church){
            if (cfg.links.church.title) $('#church-label').textContent = cfg.links.church.title;
            if (cfg.links.church.desc)  $('#ceremonia .muted')?.textContent = cfg.links.church.desc;
            if (cfg.links.church.maps)  $('#church-gmap').setAttribute('href', cfg.links.church.maps);
            if (cfg.links.church.waze)  $('#church-waze').setAttribute('href', cfg.links.church.waze);
            if (cfg.links.church.query){
              $('#church-waze').setAttribute('data-query', cfg.links.church.query);
              $('#church-gmap').setAttribute('data-query', cfg.links.church.query);
            }
          }
          if (cfg.links && cfg.links.reception){
            if (cfg.links.reception.title) $('#reception-label').textContent = cfg.links.reception.title;
            if (cfg.links.reception.maps)  $('#reception-gmap').setAttribute('href', cfg.links.reception.maps);
            if (cfg.links.reception.waze)  $('#reception-waze').setAttribute('href', cfg.links.reception.waze);
            if (cfg.links.reception.query){
              $('#reception-waze').setAttribute('data-query', cfg.links.reception.query);
              $('#reception-gmap').setAttribute('data-query', cfg.links.reception.query);
            }
          }

          // ===== RSVP: endpoint + token (fallback: Google Form) =====
          (function(){
            const rsvp = cfg.rsvp || {};
            const note = $('#rsvp-note');
            const form = $('#rsvp-form');
            const sel  = $('#rsvpSelect');
            const total= $('#rsvp-total');
            const msg  = $('#rsvp-msg');
            const wab  = $('#wa-btn');
            const fb   = $('#rsvp-fallback');
            const iframe = $('#rsvp-iframe');

            if (cfg.date && cfg.date.readable) {
              $('#rsvp-deadline').innerHTML = 'Por favor confirma antes del <strong>' + (rsvp.deadline || '10 de octubre de 2025') + '</strong>.';
            }

            // Fallback Google Form si as√≠ lo define config
            if (rsvp.type === 'google_form' && rsvp.embed_url){
              iframe.src = rsvp.embed_url;
              fb.style.display = 'block';
              note.textContent = 'Completa el formulario para confirmar tu asistencia.';
              return;
            }

            const EP = rsvp.endpoint;
            const token = qs('t') || '';

            if (!EP){
              note.textContent = 'RSVP no configurado.';
              return;
            }
            if (!token){
              note.textContent = 'Para confirmar usa tu enlace personal (incluye token).';
              return;
            }

            // Lookup
            fetch(EP + '?action=lookup&token=' + encodeURIComponent(token))
              .then(r=>r.json())
              .then(data=>{
                if (!data.ok){ note.textContent='Token no v√°lido.'; return; }

                const nombre = data.nombre || 'invitado/a';
                const allowedMax = int(data.allowed_max, 0);
                const acompPrev  = (data.acomp_prev===null || data.acomp_prev===undefined) ? null : int(data.acomp_prev,0);

                note.textContent = 'Hola ' + nombre + '. Tu cupo m√°ximo actual es de ' + allowedMax + ' acompa√±ante(s).';
                sel.innerHTML = '';
                for (let i=0;i<=allowedMax;i++){
                  const o = document.createElement('option'); o.value=String(i); o.textContent=String(i); sel.appendChild(o);
                }
                sel.value = String(acompPrev!==null ? acompPrev : allowedMax);
                total.textContent = 'Total de personas: ' + (Number(sel.value)+1);
                form.style.display = '';

                sel.addEventListener('change', ()=>{ total.textContent='Total de personas: ' + (Number(sel.value)+1); });

                form.addEventListener('submit', function(ev){
                  ev.preventDefault(); msg.textContent='Enviando‚Ä¶';
                  const p = new URLSearchParams({action:'confirm', token:token, acompanantes: sel.value});
                  fetch(EP, {method:'POST', body:p})
                    .then(r=>r.json())
                    .then(j=>{
                      if(!j.ok){ msg.textContent='Error: ' + (j.error||'No se pudo confirmar'); return; }
                      msg.textContent='¬°Confirmado! Total: ' + j.total_confirmado + '. Puedes volver a reducir si lo necesitas.';

                      const nuevo = Number(sel.value);
                      sel.innerHTML=''; for(let i=0;i<=nuevo;i++){ const o=document.createElement('option'); o.value=String(i); o.textContent=String(i); sel.appendChild(o); }
                      sel.value=String(nuevo); total.textContent='Total de personas: ' + (nuevo+1);

                      if (rsvp.phone){
                        const phone = digits(rsvp.phone);
                        const txt = 'Hola, soy ' + nombre + ' y confirmo mi asistencia con ' + nuevo + ' invitado(s).';
                        wab.href = 'https://wa.me/' + phone + '?text=' + encodeURIComponent(txt);
                        wab.style.display='inline-block';
                      }
                    })
                    .catch(()=>{ msg.textContent='Error de red. Intenta de nuevo.'; });
                });
              })
              .catch(()=>{ note.textContent='No se pudo consultar el cupo (red).'; });
          })();
        }catch(e){ console.warn(e); }
      });
    })();
  </script>

  <!-- Parche: en m√≥vil mostrar "SEG" en vez de "SEGUNDOS" -->
  <script>
  (function () {
    var MOBILE_QUERY = '(max-width: 768px)';
    var RE_SEG = /\bsegundos?\b/i;
    function texto(){ return matchMedia(MOBILE_QUERY).matches ? 'SEG' : 'SEGUNDOS'; }
    function aplicar(){
      var lbl = document.querySelector('#countdown .cd-box:last-child .cd-label');
      if (lbl) lbl.textContent = texto();
    }
    aplicar();
    var mq = matchMedia(MOBILE_QUERY);
    if (mq.addEventListener) mq.addEventListener('change', aplicar); else mq.addListener(aplicar);
    addEventListener('resize', aplicar); addEventListener('orientationchange', aplicar);
    new MutationObserver(aplicar).observe(document.getElementById('countdown'), {childList:true, subtree:true});
  })();
  </script>
</body>
</html>
